{% extends "base.html.twig" %}

{% block title %}Sujet : {{sujet.title}}{% endblock %}

{% form_theme formCommentaire "form/_formField.html.twig" %}
{% set date = sujet.date %}

{% block body %}
    <div class="slide sujetShow">
        <div class="wrapper">
            <a href="{{path('forum_index')}}" class='backButton'>Retour</a>
            <div class="sujetHeader">
                 <h2>{{sujet.title}}</h2>
                 <div class="buttons">
                    <a href="">Répondre</a>
                    {% if app.user == sujet.user %}
                        <a href="{{path('forum_update',{'id':sujet.id})}}">Modifier</a>
                    {% endif %}
                     {% if is_granted('ROLE_ADMIN') or app.user == sujet.user %}
                        <div class="buttonDelete deleteButtonUser">Supprimer</div>
                    {% endif %}
                 </div>
            </div>
            {% for label, messages in app.flashes %}
                <div class="container mt-3 p-0">
                    <div class="alert alert-{{label}}">
                        {% for message in messages %}
                            <p>{{ message | raw }}</p>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
            <div class="sujetBody">
                <h3>{{sujet.user.username}} - {{date | date('d/m/Y à H:i:s')}}</h3>
                {% if sujet.image %}
                    <img src="/uploads/forum/{{sujet.image}}" alt="Image de {{sujet.title}}">
                {% endif %}
                <p>{{sujet.description}}</p>
            </div>
            <h4>Résponses :</h4>
            <div class="commentaires">
                <div class="commentaire">
                    {% for commentaire in pagination.data %}
                        {{dump(pagination.data)}}
                        {% set dateCommentaire = commentaire.date %}
                        {# <div class="headerCommentaire">
                            <h5>{{commentaire.user.username}} - {{date | date('d/m/Y à H:i:s')}}</h5>
                            <p>{{commentaire.message}}</p>
                        </div> #}
                    {% endfor %}
                </div>
            </div>
            {{pagination.display}}
            {{form_start(formCommentaire)}}
                {{form_widget(formCommentaire)}}
                <button type="submit" class="boutonSubmit">Répondre</button>
            {{form_end(formCommentaire)}}
        </div>
    </div>
    {% include "partials/deleteAlert.html.twig" with {'type':'','title': "Votre sujet " ~ sujet.title,'id':sujet.id, 'route':'forum_delete'} %}
{% endblock %}